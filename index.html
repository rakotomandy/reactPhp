<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>React + PHP â€“ Lift State Up</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body
    class="bg-gray-100 min-h-screen flex mt-[200px] overflow-hidden justify-center p-4"
  >
    <div id="root" class="w-full max-w-2xl"></div>

    <!-- React + Babel (CDN) -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
      const { useState, useEffect } = React;

      function App() {
        const [data, setData] = useState([]);

        useEffect(() => {
          getData();
        }, []);

        async function getData() {
          const res = await fetch("http://localhost/mvc/form/data");
          const json = await res.json();
          setData(json);
        }

        async function handleSubmit(name, email) {
          const send = await fetch("http://localhost/mvc/form/insert", {
            method: "POST",
            headers: { "content-type": "application/json" },
            body: JSON.stringify({ name: name.trim(), email: email.trim() }),
          });

          if (send.json()) {
            alert("user inserted successfully");
            getData();
          }
        }
        return (
          <div>
            <InsertForm data={data} handleSubmit={handleSubmit} />
          </div>
        );
      }

      function InsertForm({ handleSubmit, data }) {
        const [name, setName] = useState("");
        const [email, setEmail] = useState("");
        const submitUser = async (e) => {
          e.preventDefault();
          handleSubmit(name, email);
          setName("");
          setEmail("");
        };

        return (
          <>
            <form
              onSubmit={submitUser}
              className=" flex gap-3 justify-center w-200 bg-green-200 p-4 rounded"
            >
              <input
                type="text"
                value={name}
                onChange={(e) => setName(e.target.value)}
                className="bg-yellow-500 rounded p-2 text-white outline-none focus:border-2 focus:border-blue-300"
                placeholder="INSERT THE NAME"
              />
              <input
                type="text"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                className="bg-yellow-500 rounded p-2 text-white outline-none focus:border-2 focus:border-blue-300"
                placeholder="INSERT THE NAME"
              />

              <button
                type="submit"
                className="bg-blue-400 p-2 text-black rounded-md font-semibold"
              >
                INSERT
              </button>
            </form>
            <div>
              <table className="border border-collapse w-[520.5px]">
                <thead className="bg-gray-200">
                  <tr>
                    <th className="border border-gray-300">ID</th>
                    <th className="border border-gray-300">NAME</th>
                    <th className="border border-gray-300">EMAIL</th>
                  </tr>
                </thead>
                <tbody>
                  {
                    (data.length == 0 ? (
                      <tr className="text-center"><td col="3">NO USERS YET</td></tr>
                    ) : (
                      data.map((d, index) => 
                      <tr className="hover:bg-red-200" key={d.idUsers}>
                        <td className="border border-blue-200 text-center ">{d.idUsers}</td>
                        <td className="border border-blue-200 text-center ">{d.name}</td>
                        <td className="border border-blue-200 text-center ">{d.email}</td>
                      </tr>)
                    ))
                  }
                </tbody>
              </table>
            </div>
          </>
        );
      }
      /* -------------------------------------------------
            Render
            ------------------------------------------------- */
      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
