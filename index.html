<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>React + PHP – Lift State Up</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div id="root" class="w-full max-w-2xl"></div>

    <!-- React + Babel (CDN) -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
      const { useState, useEffect } = React;

      /* -------------------------------------------------
       1. PARENT – owns the shared state (lifted up)
       ------------------------------------------------- */
      function App() {
        const [data, setData] = useState([]);

        // ---------- FETCH ALL ----------
        useEffect(() => {
          fetch("http://localhost/mvc/form/data")
            .then((r) => {
              if (!r.ok) throw new Error("Network error");
              return r.json();
            })
            .then(setData)
            .catch((err) => {
              console.error(err);
              alert("Could not load data – is PHP running?");
            });
        }, []);

        // ---------- INSERT ----------
        const handleInsert = async (name) => {
          if (!name.trim()) return { success: false, message: "Name required" };

          const res = await fetch("http://localhost/mvc/form/insert", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name: name.trim() }),
          });
          const json = await res.json();

          if (json.success) {
            const newItem = { idUsers: json.id, name: name.trim() };
            setData((prev) => [...prev, newItem]);
          }
          return json; // let child show errors if needed
        };

        // ---------- DELETE ----------
        const handleDelete = async (index) => {
          const item = data[index];
          const res = await fetch("http://localhost/mvc/form/delete", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ id: item.idUsers }),
          });
          const json = await res.json();

          if (json.success) {
            setData((prev) => prev.filter((_, i) => i !== index));
          } else {
            alert(json.message || "Delete failed");
          }
        };

        return (
          <div className="bg-white shadow-xl rounded-2xl p-8">
            <h2 className="text-3xl font-bold text-center text-indigo-600 mb-8">
              React + PHP – Lift State Up
            </h2>

            <InsertForm onInsert={handleInsert} />
            <UsersTable data={data} onDelete={handleDelete} />
          </div>
        );
      }

      /* -------------------------------------------------
       2. CHILD – Insert form (receives callback)
       ------------------------------------------------- */
      function InsertForm({ onInsert }) {
        const [name, setName] = useState("");

        const submit = async (e) => {
          e.preventDefault();
          const result = await onInsert(name);
          if (result.success) setName("");
          else alert(result.message || "Insert failed");
        };

        return (
          <form onSubmit={submit} className="flex gap-3 mb-8">
            <input
              type="text"
              value={name}
              onChange={(e) => setName(e.target.value)}
              placeholder="Enter name"
              className="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition"
            />
            <button
              type="submit"
              className="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-6 py-3 rounded-lg shadow-md transition"
            >
              INSERT
            </button>
          </form>
        );
      }

      /* -------------------------------------------------
       3. CHILD – Table (receives data + delete callback)
       ------------------------------------------------- */
      function UsersTable({ data, onDelete }) {
        if (data.length === 0) {
          return (
            <p className="text-center text-gray-500 py-8">
              No users yet – add one above!
            </p>
          );
        }

        return (
          <div className="overflow-x-auto rounded-lg shadow">
            <table className="w-full border-collapse text-sm">
              <thead className="bg-indigo-100 text-indigo-800">
                <tr>
                  <th className="border border-gray-300 px-4 py-3 font-semibold">
                    ID
                  </th>
                  <th className="border border-gray-300 px-4 py-3 font-semibold">
                    NAME
                  </th>
                  <th className="border border-gray-300 px-4 py-3 font-semibold">
                    ACTION
                  </th>
                </tr>
              </thead>
              <tbody>
                {data.map((item, i) => (
                  <tr
                    key={item.idUsers}
                    className="hover:bg-indigo-50 transition"
                  >
                    <td className="border border-gray-300 px-4 py-3 text-center">
                      {item.idUsers}
                    </td>
                    <td className="border border-gray-300 px-4 py-3">
                      {item.name}
                    </td>
                    <td className="border border-gray-300 px-4 py-3 text-center">
                      <button
                        onClick={() => onDelete(i)}
                        className="bg-red-500 hover:bg-red-600 text-white font-bold px-4 py-1 rounded transition"
                      >
                        DELETE
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        );
      }

      /* -------------------------------------------------
       Render
       ------------------------------------------------- */
      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
